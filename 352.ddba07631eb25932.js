"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[352],{7352:(lt,C,o)=>{o.r(C),o.d(C,{SasieCommandeModule:()=>mt});var g=o(6814),T=o(2129),V=o(6726),t=o(4769),b=o(553),L=o(9862);let _=(()=>{var e;class d{constructor(n){this.http=n,this.urlApi=b.N.urlApi+"CompteurPieces/GetCompteurPieceByNomPiecer"}getCompteur(){return this.http.get(this.urlApi).toPromise()}}return(e=d).\u0275fac=function(n){return new(n||e)(t.LFG(L.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),d})();var v=o(5544);let x=(()=>{var e;class d{constructor(n){this.articleService=n,this.Net_HT=0,this.TTC_Ligne=0,this.HT_Ligne=0,this.Mnt_Remise=0,this.Mt_Fodec=0,this.Assete=0,this.Mnt_TVA_Ligne=0,this.Taux_Fodec=0,this.TauxMajoration=0,this.Base_HT=0,this.Montant_TVA=0,this.Taux_TVA=0,this.Montant_Remise=0,this.Tot_TTC=0,this.Tot_HT=0,this.Tot_Remise=0,this.Tot_NET_HT=0,this.Tot_Fodec=0,this.Tot_TVA=0,this.TimbreFiscal=0,this.DT_RecapTVA=[]}calculTotalLigne(n,a,m,r,l,s,h,c,dt){this.articleService.getPaarametreDiversTaux().then(M=>{this.Taux_Fodec=M[0].tauxFodec,this.TauxMajoration=M[0].tauxMajoration}),this.HT_Ligne=this.roundSQL(n*a,3),this.Mnt_Remise=this.roundSQL(this.HT_Ligne*(m/100),3),this.Net_HT=this.roundSQL(this.HT_Ligne-this.Mnt_Remise,3),l&&s&&(this.Mt_Fodec=this.roundSQL(this.Net_HT*this.Taux_Fodec,3)),this.Assete=this.roundSQL(this.Net_HT+this.Mt_Fodec,3),c||dt?this.Mnt_TVA_Ligne=this.roundSQL(0*this.Assete,3):(h||(r*=1+this.TauxMajoration),this.Mnt_TVA_Ligne=this.roundSQL(this.Assete*(r/100),3)),this.TTC_Ligne=this.roundSQL(this.Assete+this.Mnt_TVA_Ligne,3),console.log(this.TTC_Ligne)}roundSQL(n,a){console.log("dfg");const m=Math.pow(10,a);return Math.round(n*m)/m}calculTotaux(n,a,m,r,l){this.DT_RecapTVA=[],this.Tot_TTC=0,this.Tot_HT=0,this.Tot_Remise=0,this.Tot_NET_HT=0,this.Tot_Fodec=0,this.Tot_TVA=0,this.TimbreFiscal=0,this.articleService.getPaarametreDiversTaux().then(s=>{this.Taux_Fodec=s[0].tauxFodec,this.TauxMajoration=s[0].tauxMajoration,this.TimbreFiscal=s[0].timbreFiscal});try{for(const s of n){this.Base_HT=0,this.Montant_TVA=0;for(const c of a)""!==c.codeArticle.toString()&&s.tauxTva.toString()===c.tauxTva.toString()&&(this.Base_HT=this.roundSQL(m?this.Base_HT+parseFloat(c.netHt.toString())+parseFloat(c.montantFodec.toString()):this.Base_HT+parseFloat(c.montantHt.toString()),3),this.Tot_HT=this.roundSQL(this.Tot_HT+parseFloat(c.montantHt.toString()),3),this.Montant_TVA=this.roundSQL(this.Montant_TVA+parseFloat(c.montantTva.toString()),3),m&&(this.Tot_Remise=this.roundSQL(this.Tot_Remise+parseFloat(c.montantRemise.toString()),3),this.Tot_NET_HT=this.roundSQL(this.Tot_NET_HT+parseFloat(c.netHt.toString()),3),this.Tot_Fodec=this.roundSQL(this.Tot_Fodec+parseFloat(c.montantFodec.toString()),3)));let h={CodeTVA:"",BaseHT:0,TauxTVA:0,MontantTVA:0};h.CodeTVA=s.codeTva.toString(),h.BaseHT=this.Base_HT,h.TauxTVA=l?s.tauxTva:s.tauxTva*(1+this.TauxMajoration/100),h.MontantTVA=this.Montant_TVA,this.DT_RecapTVA.push(h),this.Tot_TVA=this.roundSQL(this.Tot_TVA+this.Montant_TVA,3),m?(this.Tot_Remise=this.roundSQL(this.Tot_Remise+this.Montant_Remise,3),this.Tot_TTC=this.roundSQL(this.Tot_HT-this.Tot_Remise+this.Tot_TVA+this.Tot_Fodec,3)):this.Tot_TTC=this.roundSQL(this.Tot_HT+this.Tot_TVA,3)}r&&(this.Tot_TTC=this.roundSQL(this.Tot_TTC+this.TimbreFiscal,3))}catch{}}}return(e=d).\u0275fac=function(n){return new(n||e)(t.LFG(v.n))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),d})();var f=o(5219),H=o(8645);let Z=(()=>{var e;class d{constructor(){this.reloadSubject=new H.x}reloadComponent(){this.reloadSubject.next()}getReloadObservable(){return this.reloadSubject.asObservable()}}return(e=d).\u0275fac=function(n){return new(n||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),d})();var S=o(707),A=o(4104),p=o(95),F=o(28),y=o(8349),u=o(6916);function Q(e,d){if(1&e){const i=t.EpF();t.TgZ(0,"app-client-commande",4),t.NdJ("clientUpdated",function(a){t.CHM(i);const m=t.oxw();return t.KtG(m.handleClientUpdated(a))}),t.qZA()}}function U(e,d){if(1&e){const i=t.EpF();t.TgZ(0,"div",5)(1,"div",6)(2,"div",7)(3,"h6",8),t._uU(4,"Bon de Commande Instance N\xb0"),t.qZA()(),t.TgZ(5,"div",7)(6,"h6"),t._uU(7),t.qZA()()(),t.TgZ(8,"div",9)(9,"div")(10,"h6",10),t._uU(11,"Client :"),t.qZA()(),t.TgZ(12,"div")(13,"h6"),t._uU(14),t.qZA()()(),t.TgZ(15,"div")(16,"h6"),t._uU(17),t.qZA()(),t.TgZ(18,"span",11),t._UZ(19,"button",12),t.TgZ(20,"button",13),t.NdJ("click",function(){t.CHM(i);const a=t.oxw();return t.KtG(a.articleListe())}),t.qZA(),t.TgZ(21,"button",14),t.NdJ("click",function(){t.CHM(i);const a=t.oxw();return t.KtG(a.valider())}),t.qZA()(),t._UZ(22,"p-toast",15),t.TgZ(23,"div",16)(24,"div",17)(25,"div")(26,"h6",8),t._uU(27,"Total Quantite "),t.qZA()(),t.TgZ(28,"div")(29,"h6"),t._uU(30),t.qZA()()(),t.TgZ(31,"div",18)(32,"div")(33,"h6",8),t._uU(34,"Total TTC "),t.qZA()(),t.TgZ(35,"div")(36,"h6"),t._uU(37),t.qZA()()()()()}if(2&e){const i=t.oxw();t.xp6(7),t.lnq("",i.compteur.prefixPiece,"",i.compteur.annee,"",i.compteur.compteur,""),t.xp6(7),t.Oqu(i.client.codeClient),t.xp6(3),t.Oqu(i.client.raisonSociale),t.xp6(13),t.hij(": ",i.quantiteTot," "),t.xp6(7),t.hij(": ",i.prixTot," ")}}function N(e,d){1&e&&(t.TgZ(0,"tr")(1,"th",24),t._uU(2,"Code"),t.qZA(),t.TgZ(3,"th",25),t._uU(4,"Quantite"),t.qZA(),t.TgZ(5,"th",25),t._uU(6,"PrixVenteTTC"),t.qZA()())}function R(e,d){if(1&e){const i=t.EpF();t.TgZ(0,"div",30)(1,"button",31),t.NdJ("click",function(){t.CHM(i);const a=t.oxw(2).rowIndex,m=t.oxw(2);return t.KtG(m.incrementQuantity(a,"dec"))}),t._uU(2,"-"),t.qZA(),t.TgZ(3,"input",32),t.NdJ("ngModelChange",function(a){t.CHM(i);const m=t.oxw(2).$implicit;return t.KtG(m.quantiteCommander=a)}),t.qZA(),t.TgZ(4,"button",33),t.NdJ("click",function(){t.CHM(i);const a=t.oxw(2).rowIndex,m=t.oxw(2);return t.KtG(m.incrementQuantity(a,"incr"))}),t._uU(5,"+"),t.qZA()()}if(2&e){const i=t.oxw(2).$implicit;t.xp6(3),t.Q6J("ngModel",i.quantiteCommander),t.xp6(1),t.Q6J("disabled",0===i.quantite)}}function O(e,d){if(1&e&&t._uU(0),2&e){const i=t.oxw(2).$implicit;t.hij(" ",i.quantiteCommander," ")}}function j(e,d){if(1&e&&(t.ynx(0),t.TgZ(1,"tr")(2,"td",26),t._uU(3),t.qZA(),t.TgZ(4,"td",27)(5,"p-cellEditor"),t.YNc(6,R,6,2,"ng-template",28),t.YNc(7,O,1,1,"ng-template",29),t.qZA()(),t.TgZ(8,"td",25),t._uU(9),t.qZA()(),t.BQk()),2&e){const i=t.oxw().$implicit;t.xp6(3),t.Oqu(i.article.codeArticle),t.xp6(6),t.Oqu(i.totalCommander)}}function w(e,d){if(1&e&&t.YNc(0,j,10,2,"ng-container",3),2&e){const i=t.oxw(2);t.Q6J("ngIf",i.ligneCmd.length>0)}}function P(e,d){1&e&&(t.TgZ(0,"tr")(1,"td",34),t._uU(2,"Pas d'articles"),t.qZA()())}function B(e,d){if(1&e&&(t.TgZ(0,"div",19)(1,"p-table",20),t.YNc(2,N,7,0,"ng-template",21),t.YNc(3,w,1,1,"ng-template",22),t.YNc(4,P,3,0,"ng-template",23),t.qZA()()),2&e){const i=t.oxw();t.xp6(1),t.Q6J("value",i.commande.lignesCommande)("scrollable",!0)}}function E(e,d){if(1&e){const i=t.EpF();t.TgZ(0,"div")(1,"app-liste-article-commande",35),t.NdJ("ArticlesUpdated",function(a){t.CHM(i);const m=t.oxw();return t.KtG(m.handleArticleUpdated(a))})("showinSaisie",function(a){t.CHM(i);const m=t.oxw();return t.KtG(m.handleShowUpdated(a))}),t.qZA()()}if(2&e){const i=t.oxw();t.xp6(1),t.Q6J("dialog",!0)("selectedItems",i.commande.lignesCommande)}}let q=(()=>{var e;class d{constructor(n,a,m,r,l,s,h){this.router=n,this.compteurService=a,this.utilities=m,this.articleService=r,this.service=l,this.reloadEventService=s,this.cdr=h,this.listeClient=!0,this.dialogListArticle=!1,this.ligneCmd=[],this.quantiteTot=0,this.prixTot=0,this.ls_LigneCommandeVente=[],this.bonCommandeVente={},this.listCmd=!1}ngOnInit(){this.commande={lignesCommande:[],totalCommande:0,quantiteTotal:0},this.articleService.getAllTva().then(n=>{this.P_DT_TVA=n}),this.compteurService.getCompteur().then(n=>{this.compteur=n},n=>{console.error("Erreur",n)})}handleClientUpdated(n){this.client=n,this.listeClient=!1,this.listCmd=!0,this.cdr.detectChanges()}handleArticleUpdated(n){this.commande=n,this.quantiteTot=this.commande.quantiteTotal,this.prixTot=this.utilities.roundSQL(this.commande.totalCommande,3),this.ligneCmd=n.lignesCommande,this.dialogListArticle=!1,this.listCmd=!0,this.cdr.detectChanges()}decrementQuantity(n){}incrementQuantity(n,a){"incr"===a?(this.quantiteTot++,this.commande.lignesCommande[n].quantiteCommander++,this.commande.lignesCommande[n].quantite--):(this.quantiteTot--,this.commande.lignesCommande[n].quantiteCommander--,this.commande.lignesCommande[n].quantite++);let m=this.commande.lignesCommande[n].prixVenteTTC*this.commande.lignesCommande[n].quantiteCommander;this.commande.totalCommande=this.commande.totalCommande-this.commande.lignesCommande[n].totalCommander+m,this.commande.lignesCommande[n].totalCommander=this.utilities.roundSQL(m,3),this.prixTot=this.utilities.roundSQL(this.commande.totalCommande,4),0===this.commande.lignesCommande[n].quantiteCommander&&this.commande.lignesCommande.splice(n,1)}articleListe(){this.dialogListArticle=!0,this.listCmd=!1,this.cdr.detectChanges()}valider(){for(let l=0;l<this.ligneCmd.length;l++){this.utilities.calculTotalLigne(this.ligneCmd[l].prixHt,this.ligneCmd[l].quantiteCommander,0,this.ligneCmd[l].tauxTva,this.ligneCmd[l].fodec,this.client.fodec,this.client.assujetti,this.client.exoneration,this.client.export);let s={};s.codeArticle=this.ligneCmd[l].article.codeArticle,s.designationArticle=this.ligneCmd[l].article.designation,s.montantFodec=this.utilities.Mt_Fodec,s.montantHt=this.utilities.HT_Ligne,s.montantRemise=this.utilities.Mnt_Remise,s.montantTtc=this.utilities.TTC_Ligne,s.montantTva=this.utilities.Mnt_TVA_Ligne,s.netHt=this.utilities.Net_HT,s.numeroBonCommandeVente=this.compteur.prefixPiece+this.compteur.annee+this.compteur.compteur,s.numeroOrdre=l+1,s.observation="integration Web",s.prixAchatNet=0,s.prixVenteHt=this.ligneCmd[l].prixHt,s.quantite=this.ligneCmd[l].quantiteCommander,s.tauxRemise=0,s.tauxTva=this.ligneCmd[l].tauxTva,this.ls_LigneCommandeVente.push(s)}this.utilities.calculTotaux(this.P_DT_TVA,this.ls_LigneCommandeVente,!1,this.client.timbreFiscal,this.client.assujetti);const a=localStorage.getItem("token"),m=(0,V.Z)(a);this.bonCommandeVente.codeClient=this.client.codeClient,this.bonCommandeVente.codeLivreur=m.CodeLivreur,this.bonCommandeVente.codeTypeVente="VENTE",this.bonCommandeVente.consulter=!0,this.bonCommandeVente.dateBonCommandeVente=new Date,this.bonCommandeVente.dateCreation=new Date,this.bonCommandeVente.dateReferenceClient=new Date,this.bonCommandeVente.heureCreation=new Date,this.bonCommandeVente.delaiLivraison=90,this.bonCommandeVente.montantRemiseExceptionnel=0,this.bonCommandeVente.numeroBonCommandeVente=this.compteur.prefixPiece+this.compteur.annee+this.compteur.compteur,this.bonCommandeVente.nomUtilisateur=m.NomUtilisateur,this.bonCommandeVente.numeroDevisVente="",this.bonCommandeVente.numeroEtat="E01",this.bonCommandeVente.observation="",this.bonCommandeVente.referenceClient="",this.bonCommandeVente.tauxRemiseExceptionnel=0,this.bonCommandeVente.totalFodec=this.utilities.Tot_Fodec,this.bonCommandeVente.totalHt=this.utilities.Tot_HT,this.bonCommandeVente.totalNetHt=this.utilities.Tot_NET_HT,this.bonCommandeVente.totalRemise=this.utilities.Tot_Remise,this.bonCommandeVente.totalTtc=this.utilities.Tot_TTC,this.bonCommandeVente.totalTva=this.utilities.Tot_TVA,this.articleService.postBonCommandeVente({bonCommande:this.bonCommandeVente,ligneCommande:this.ls_LigneCommandeVente}).then(l=>{this.service.add({key:"commandSuccess",severity:"success",summary:"Success Message",detail:"Votre Commande est pass\xe9 avec succ\xe9s"}),setTimeout(()=>{this.router.navigate(["/"])},600)}).catch(l=>{console.error("HTTP Error:",l)})}handleShowUpdated(n){this.dialogListArticle=n,this.listCmd=!n,this.cdr.detectChanges()}}return(e=d).\u0275fac=function(n){return new(n||e)(t.Y36(T.F0),t.Y36(_),t.Y36(x),t.Y36(v.n),t.Y36(f.ez),t.Y36(Z),t.Y36(t.sBO))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-sasie-commande"]],decls:4,vars:4,consts:[[3,"clientUpdated",4,"ngIf"],["class","card bonCommande",4,"ngIf"],["class","card ligneCmd",4,"ngIf"],[4,"ngIf"],[3,"clientUpdated"],[1,"card","bonCommande"],[2,"display","flex","justify-content","space-between"],[1,"p-field","p-col-12","p-md-2","amount"],[2,"color","red"],[2,"display","flex"],[2,"color","red","float","left"],[1,"",2,"display","flex","justify-content","space-around"],["pButton","","pRipple","","icon","pi pi-qrcode",1,"p-button-outlined","p-button-info"],["pButton","","pRipple","","icon","pi pi-pencil",1,"p-button-outlined","p-button-info",3,"click"],["pButton","","pRipple","","icon","pi pi-backward",1,"p-button-outlined","p-button-info",3,"click"],["key","commandSuccess"],[1,"mt-2",2,"display","flex","justify-content","space-between"],[1,"p-field","p-col-12","p-md-2","amount",2,"display","flex","justify-content","space-between"],[1,"p-field","p-col-12","p-md-2","amount",2,"display","flex","justify-content","center"],[1,"card","ligneCmd"],["scrollDirection","both","scrollHeight","400px","styleClass","mt-3","responsiveLayout","scroll",2,"box-shadow","0 8px 16px rgba(0, 0, 0, 0.2)",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pFrozenColumn","",2,"width","200px"],[2,"width","200px"],["pFrozenColumn","",1,"font-bold",2,"width","200px"],["pEditableColumn","",2,"width","200px"],["pTemplate","input"],["pTemplate","output"],[1,"",2,"display","flex","justify-content","space-around","max-width","200px"],[3,"click"],["type","number",1,"input-dataGrid","banque-input",2,"max-width","30px",3,"ngModel","ngModelChange"],[3,"disabled","click"],["colspan","3"],[3,"dialog","selectedItems","ArticlesUpdated","showinSaisie"]],template:function(n,a){1&n&&(t.YNc(0,Q,1,0,"app-client-commande",0),t.YNc(1,U,38,7,"div",1),t.YNc(2,B,5,2,"div",2),t.YNc(3,E,2,2,"div",3)),2&n&&(t.Q6J("ngIf",a.listeClient),t.xp6(1),t.Q6J("ngIf",!a.listeClient&&!a.dialogListArticle),t.xp6(1),t.Q6J("ngIf",a.listCmd),t.xp6(1),t.Q6J("ngIf",a.dialogListArticle))},dependencies:[g.O5,f.jx,S.Hq,A.FN,p.Fj,p.wV,p.JJ,p.On,F.O,y.R,u.iA,u.on,u.Wq,u.YL],styles:['@charset "UTF-8";.bonCommande[_ngcontent-%COMP%]{box-shadow:0 8px 16px #0003}.ligneCmd[_ngcontent-%COMP%]{background:var(--surface-card);border:1px solid var(--surface-border);padding:1rem;margin-bottom:2rem;box-shadow:var(--card-shadow);border-radius:12px;box-shadow:0 8px 16px #0003}h1[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{font-weight:600;word-break:break-all;font-family:Courier New,Courier,monospace}div[_ngcontent-%COMP%]{text-align:center;background:#fdfdfd}div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:50%;height:60px;width:60px;margin:4px}div[_ngcontent-%COMP%]   buttondisabled[_ngcontent-%COMP%]{cursor:no-drop}div[_ngcontent-%COMP%]   .data[_ngcontent-%COMP%]{background:antiquewhite;border-radius:5px}.origin-overlay[_ngcontent-%COMP%]   .qrcode-tooltip[_ngcontent-%COMP%]   .qrcode-tooltip-temp[_ngcontent-%COMP%]{padding:5px!important}.dropdown-container[_ngcontent-%COMP%]{width:200px}.dropdown-item[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}']}),d})(),J=(()=>{var e;class d{}return(e=d).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[T.Bz.forChild([{component:q,path:""}]),T.Bz]}),d})();var Y=o(4237),D=o(8981),G=o(1825),I=o(3714),z=o(3965),K=o(6022),$=o(7327),W=o(7213),X=o(5389),k=o(7161),tt=o(9502),et=o(8608),nt=o(5359),it=o(5043),ot=o(9445),at=o(676),st=o(3885);let mt=(()=>{var e;class d{}return(e=d).\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({providers:[_,x],imports:[g.ez,J,Y.FI,D.f,G.C,I.j,z.kW,K.Xt,$.WN,S.hJ,W.S,X.fx,k.O,tt.$,A.EV,et.TX,p.u5,nt.x,it.t,ot.Q,at.ClientCommandeModule,st.ListeArticleCommandeModule,u.U$]}),d})()}}]);